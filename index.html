<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Пример Biometrics и информации о пользователе</title>
  <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
  <script>
    // Обработчик событий
    Telegram.WebApp.onEvent('biometricManagerUpdated', function() {
      const biometricManager = Telegram.WebApp.BiometricManager;
      console.log("BiometricManager обновлен:");
      console.log("Инициализирован: ", biometricManager.isInited);
      console.log("Доступен: ", biometricManager.isBiometricAvailable);
      console.log("Тип: ", biometricManager.biometricType);
      // ... и т.д.
    });

    document.addEventListener('DOMContentLoaded', function() {
      const biometricManager = Telegram.WebApp.BiometricManager;
      const userInfo = document.getElementById('user-info');

      // Проверка доступности Biometrics
      if (!biometricManager.isBiometricAvailable) {
        alert("Биометрия недоступна на этом устройстве");
        return;
      }

      // Инициализация
      biometricManager.init(); 

      // Вывод информации о пользователе
      userInfo.innerHTML = `
        <p><strong>Идентификатор пользователя:</strong> ${Telegram.WebApp.initDataUnsafe.user.id}</p>
        <p><strong>Имя пользователя:</strong> ${Telegram.WebApp.initDataUnsafe.user.username || "Неизвестно"}</p>
        <p><strong>Имя:</strong> ${Telegram.WebApp.initDataUnsafe.user.first_name || "Неизвестно"} ${Telegram.WebApp.initDataUnsafe.user.last_name || "Неизвестно"}</p>
        <p><strong>Запрос:</strong> ${JSON.stringify(Telegram.WebApp.initDataUnsafe.query_id || "Отсутствует", null, 2)}</p>
        <p><strong>Данные:</strong> ${JSON.stringify(Telegram.WebApp.initData || "Отсутствуют", null, 2)}</p>
        <p><strong>Параметры темы:</strong> ${JSON.stringify(Telegram.WebApp.themeParams || "Отсутствуют", null, 2)}</p>
      `;

      // Кнопка для запроса доступа
      const requestButton = document.getElementById('request-button');
      requestButton.addEventListener('click', function() {
        biometricManager.requestAccess({reason: "Ваша биометрия требуется для ..." }, function(access_granted) {
          if (access_granted) {
            alert("Доступ к биометрии получен!");
          } else {
            alert("Доступ к биометрии отклонен.");
          }
        });
      });

      // Кнопка для аутентификации
      const authButton = document.getElementById('auth-button');
      authButton.addEventListener('click', function() {
        biometricManager.authenticate({reason: "Ваша биометрия требуется для ..." }, function(success, token) {
          if (success) {
            alert("Аутентификация успешна! Токен: " + token);
          } else {
            alert("Аутентификация не удалась.");
          }
        });
      });
    });
  </script>
</head>
<body>
  <div id="user-info"></div>
  <button id="request-button">Запросить доступ к биометрии</button>
  <button id="auth-button">Аутентифицироваться</button>
</body>
</html>
